# Лабораторная работа № 1
## Тема: Исследование методов квантования цифровых сигналов изображений
## Цель работы: ознакомиться с методами квантования цифровых изображений, исследовать влияние нелинейных предыскажений на результаты квантования, определить число полезных разрядов при квантовании сигнала, пораженного шумом.
## Задание по работе:
* Изучить теоретическую часть работы.
* Промоделировать квантование цифрового изображения, оценить субъективные и объективные ошибки квантования.
* Выполнить расчет зависимости качества изображения при квантовании от числа уровней квантования, нелинейного предыскажения и наличия шума в сигнале.

### 1. Теоретическая часть
#### 1.1. Введение
Для получения цифрового сигнала из непрерывного сигнала необходимо кроме дискретизации по времени произвести квантование по амплитуде. Квантование состоит в том, что непрерывному по амплитуде сигналу ставится в соответствие конечное множество целочисленных значений сигнала, пропорциональных непрерывному значению.
Для этого динамический диапазон сигнала  разбивается на конечное число интервалов – интервалов квантования. Каждому интервалу ставится в соответствие одно значение, называемое уровнем квантования, кодируемое двоичным кодом. Все значения сигнала, попадающие в некоторый интервал, обозначаются одним числом, определенным для данного интервала.
Пусть  – амплитуда сигнала в дискретном представлении, f – значение сигнала, принадлежащее q-му интервалу квантования. При использовании L-разрядного кода число уровней квантования равно .Ошибка квантования (шум квантования) может характеризоваться величиной:
                                                             .                                                         (1)
Дисперсия ошибки  отличия f от его квантованного представления :
                                                       ,                                                   (2)
где ,  – границы q-го интервала квантования, p(f) – плотность вероятности распределения входного сигнала.

#### 1.2. Оптимальное квантование
Оптимальным будем считать такой выбор интервалов квантования и значений их представителей, при котором  минимальна.
Пусть плотность вероятности значений исходного сигнала постоянна в пределах интервала квантования, тогда:
        (3)
Оптимальное положение уровня квантования  в интервале (,) можно найти, решая задачу о минимуме ошибки как функции от . Приравнивая нулю производную от  по :
,
получаем:
                                                          .                                                      (4)
Из (4) оптимальное значение уровня квантования соответствует середине интервала квантования, при этом максимальная ошибка квантования внутри интервала составляет не более половины интервала квантования. Подставив выражение (4) в (3), получим:
                                                          .                                             (5)
Дисперсия ошибки квантования:
                                         .                                         (6)
В общем случае оптимальное положение пороговых уровней и уровней квантования получают из точного уравнения ошибки квантования, полученного с учетом (2):
                                                .                                        (7)
Дифференцируя  по переменным  и  и приравнивая производные нулю, получим систему уравнений:
.
После преобразований получаем систему уравнений:
                                                   ,                                               (8)
где q = 1, 2, ..., 2L.

Решая эти уравнения рекуррентным способом, для заданной плотности вероятностей находят оптимальные значения пороговых уровней и уровней квантования. Макс решил такую задачу для гауссовой плотности и составил таблицы размещения пороговых уровней, в зависимости от числа уровней квантования. На рис. 1 представлена амплитудная характеристика квантователя Макса [1] для трехразрядного представления сигнала.

Рис. 1 – Амплитудная характеристика оптимального квантователя Макса для 
трехразрядного кодирования при нормальном законе распределения амплитуды сигнала
Дисперсия ошибки квантования для оптимального квантователя уменьшается до значения:
                                            .                                   (9)
Для частного случая равномерной плотности распределения сигнала, при которой:
,
оптимальные значения уровней квантования из (8 б) определяются в соответствии с выражением:
.
Оптимальные значения пороговых уровней в соответствии с (8 а):
.
Следовательно, при равномерной плотности сигнала изображения оптимальным является равномерное квантование, при котором интервал квантования:
. (10),
а плотность распределения:
.
Дисперсия шума квантования в этом случае равна (9):
                                                             .                                                     (11)
Отношение сигнала к среднеквадратическому отклонению (СКО) шума квантования в этом случае составляет:
                 , дБ          (12)
Из (12) следует, что увеличение числа разрядов квантования на 1 приводит к повышению отношения сигнал/шум (С/Ш) примерно на 6 дБ. 
Существующие устройства осуществляют обычно равномерное квантование сигналов. Используя такие устройства, оптимальное квантование можно осуществить, если перед равномерным квантованием сигнал подвергнуть нелинейному преобразованию (предыскажению), формирующему сигнал с равномерной плотностью вероятности.

#### 1.3. Квантование сигнала при наличии шумов
Рассмотрим воздействие аддитивного шума на процесс квантования при равномерной амплитудной характеристике квантователя.
Входной сигнал представим в виде:
,
где  – входной полезный сигнал;  – аддитивный шум.
Квантование считается безошибочным, если сигнал  попадает в тот же интервал квантования, что и сигнал . Если же сигнал  попадает в другие интервалы квантования, то возникают дополнительные ошибки квантования, вызванные шумом. Количественную оценку влияния шума на квантование дал Фридман [2]. Построенная им кривая представлена на рисунке как кривая 0.
При построении этой кривой предполагается, что значения сигнала равновероятны в пределах диапазона квантования. Шум нормальный с СКО . Кривая соответствует вероятности правильного присвоения двоичного числа, соответствующего незашумленному сигналу с ошибкой  0 в зависимости от , равного отношению шага квантования  к  шума. Фульц расширил рамки анализа, определив вероятность присвоения данного двоичного числа уровню, отличающемуся на величину  n от правильного уровня.
Формула интегрального распределения ошибок квантования, обусловленных шумом, имеет вид:
, (13)
где ,
                         ,                 (13)
где  – интеграл вероятностей.

Рис. 2 – График зависимости вероятности квантования с точностью до  n 
уровней квантования от отношения интервала квантования к СКО аддитивного шума . Кривая 0 соответствует ошибке  0 , кривая 1 соответствует ошибке  1 и т.д. справа налево.
Определим понятие L полезных разрядов. Если имеется L полезных разрядов, то это означает, что в результате действия шума вероятность правильного формирования (L+1) разряда составляет 0,5. То есть, если мы выбираем 8 полезных разрядов, то это означает, что 9-й разряд правильно не опознается, т.е. вероятность правильного прочтения этого разряда равна 0,5. Кривая  0 на рис. 2 показывает, что разряду L + 1 (вероятность 0,5) соответствует значение  = 1,47. Значит, при L полезных разрядах ((L + 1)-й не нужен)  = 1,472 = 2,94, т.е. шаг квантования должен быть в 2,94 раза больше СКО шума.
Качество работы системы можно оценивать также по уровню шума, вводимого квантователями (аналого-цифровыми преобразователями). Мощность шума (), вносимого процессом квантования, определяется в соответствии с (11). Будем называть систему уравновешенной, если дисперсия шума квантования равна сумме дисперсий всех шумовых сигналов любого происхождения, генерируемых в системе до квантования, т.е.
 или .
Таким образом, на основании двух критериев можно пользоваться общим правилом, согласно которому отношение шага квантования к СКО шума примерно равно 3.
При n = 0 кривая соответствует вероятности безошибочного квантования при наличии шума. Ее можно использовать для выбора числа уровней квантования при заданной мощности шума и требуемой достоверности отсчета.

### 2. Экспериментальная часть

В данной лабораторной работе исследуется равномерное квантование изображений. Оценивается зависимость эффективности квантования от числа уровней квантования, предыскажения изображения и наличия шума в изображении. Для выполнения работы необходимо промоделировать процессы квантования изображения и произвести оценку качества квантования.

Порядок выполнения работы

1. Выбрать исходное 8-ми разрядное изображение. В качестве изображения можно взять изображение «Лена» или другое портретное изображение.
2. Выполнить квантование этого изображения на 16, 32, 64 и 128 уровней.
    1. Оценить размах сигнала , его математическое ожидание  и СКО .
    2. Вычислить теоретическое значение , руководствуясь уравнением (11) для оптимального квантователя. При этом , где L – число разрядов, например, при квантовании на 64 уровня (L = 6) .
    3. Оценить отношение С/Ш для оптимального квантования в соответствии с уравнением (12), учитывая реальный размах сигнала, дБ.                                               (14)
    4. Оценить СКО шума квантования как СКО сигнала разности изображений квантованного и исходного .
    5. Оценить относительное СКО в соответствии с формулой:                                                        (15)
    6. Определить отношение СКО сигнала к СКО шума квантования по формуле: ,                                                 (16)где .
    7. Оценить отношение сигнал/шум для квантованных изображений в соответствии с формулой (14).
    8. На основании эксперимента построить графики зависимости отношения сигнал/шум и относительного СКО от числа уровней квантования и сравнить их с теоретическими оценками.
3. Наложить на исходное изображение реализацию нормального шума (0,) [3].
4. Выполнить пункт 2 для этого изображения.
5. Выполнить квантование исходного изображения и изображения с шумом на 8 уровней. Оценить, как влияет шум на формирование ложных контуров на изображении.
6. Выполнить эквализацию гистограмм изображений. Выполнить квантование исходного и нелинейно преобразованного изображения на 8 уровней. Сравнить полученные изображения.
7. Проанализировать полученные результаты, составить отчет о моделировании и выполненных исследованиях, сделать выводы по работе.
